<article class="ocpArticleContent">
 <section class="ocpIntroduction">
  <p>
   The
   <b class="ocpLegacyBold">
    PIVOTBY
   </b>
   function allows you to create a summary of your data via a formula. It supports grouping along two axis and aggregating the associated values. For instance, if you had a table of sales data, you might generate a summary of sales by state and year.
  </p>
  <div class="ocpAlert">
   <p class="ocpAlertSection">
    <b class="ocpNote">
     Note:
    </b>
    Though it can produce similar outputs, PIVOTBY is not directly related to Excel's PivotTable feature.
   </p>
  </div>
 </section>
 <section aria-labelledby="ID0EDF" class="ocpSection">
  <h2 class="" id="ID0EDF">
   Syntax
  </h2>
  <p>
   The
   <b class="ocpLegacyBold">
    PIVOTBY
   </b>
   function allows you to group, aggregate, sort, and filter data based on the row and column fields that you specify.
  </p>
  <p>
   The syntax of the PIVOTBY function is:
  </p>
  <p>
   <b class="ocpLegacyBold">
    PIVOTBY(row_fields,col_fields,values,function,[field_headers],[row_total_depth],[row_sort_order],[col_total_depth],[col_sort_order],[filter_array],[relative_to])
   </b>
  </p>
  <p>
  </p>
  <p>
   ​​​​​​​
  </p>
  <table aria-label="" class="banded">
   <thead>
    <tr>
     <th>
      <p>
       Argument
      </p>
     </th>
     <th>
      <p>
       Description
      </p>
     </th>
    </tr>
   </thead>
   <tbody>
    <tr>
     <td>
      <p>
       <b class="ocpLegacyBold">
        row_fields
       </b>
      </p>
      <p>
       (required)
      </p>
     </td>
     <td>
      <p>
       A column-oriented array or range that contains the values which are used to group rows and generate row headers.
      </p>
      <p>
       The array or range may contain multiple columns. If so, the output will have multiple row group levels.
      </p>
     </td>
    </tr>
    <tr>
     <td>
      <p>
       <b class="ocpLegacyBold">
        col_fields
       </b>
      </p>
      <p>
       (required)
      </p>
     </td>
     <td>
      <p>
       A column-oriented array or range that contains the values which are used to group columns and generate column headers.
      </p>
      <p>
       The array or range may contain multiple columns. If so, the output will have multiple column group levels.
      </p>
     </td>
    </tr>
    <tr>
     <td>
      <p>
       <b class="ocpLegacyBold">
        values
       </b>
      </p>
      <p>
       (required)
      </p>
     </td>
     <td>
      <p>
       A column-oriented array or range of the data to aggregate.
      </p>
      <p>
       The array or range may contain multiple columns. If so, the output will have multiple aggregations.
      </p>
     </td>
    </tr>
    <tr>
     <td>
      <p>
       <b class="ocpLegacyBold">
        function
       </b>
      </p>
      <p>
       (required)
      </p>
     </td>
     <td>
      <p>
       A lambda function or eta-reduced lambda (SUM, AVERAGE, COUNT, etc) that defines how to aggregate the values.
      </p>
      <p>
       A vector of lambdas can be provided. If so, the output will have multiple aggregations. The orientation of the vector will determine whether they are laid out row- or column-wise.
      </p>
     </td>
    </tr>
    <tr>
     <td>
      <p>
       <b class="ocpLegacyBold">
        field_headers
       </b>
      </p>
      <p>
      </p>
     </td>
     <td>
      <p>
       A number that specifies whether the
       <b class="ocpLegacyBold">
        row_fields
       </b>
       ,
       <b class="ocpLegacyBold">
        col_fields
       </b>
       and
       <b class="ocpLegacyBold">
        values
       </b>
       have headers and whether field headers should be returned in the results. The possible values are:
      </p>
      <p>
       <b class="ocpLegacyBold">
        Missing
       </b>
       : Automatic.
       <br aria-hidden="true"/>
       <b class="ocpLegacyBold">
        0
       </b>
       : No
       <br aria-hidden="true"/>
       <b class="ocpLegacyBold">
        1
       </b>
       : Yes and don't show
       <br aria-hidden="true"/>
       <b class="ocpLegacyBold">
        2
       </b>
       : No but generate
       <br aria-hidden="true"/>
       <b class="ocpLegacyBold">
        3
       </b>
       : Yes and show
      </p>
      <div class="ocpAlert">
       <p class="ocpAlertSection">
        <b class="ocpNote">
         Note:
        </b>
        Automatic assumes the data contains headers based on the values argument. If the 1st value is text and the 2nd value is a number, then the data is assumed to have headers. Fields headers are shown if there are multiple row or column group levels.
       </p>
      </div>
     </td>
    </tr>
    <tr>
     <td>
      <p>
       <b class="ocpLegacyBold">
        row_total_depth
       </b>
      </p>
      <p>
      </p>
     </td>
     <td>
      <p>
       Determines whether the row headers should contain totals. The possible values are:
      </p>
      <p>
       <b class="ocpLegacyBold">
        Missing
       </b>
       : Automatic: Grand totals and, where possible, subtotals.
       <br aria-hidden="true"/>
       <b class="ocpLegacyBold">
        0
       </b>
       : No Totals
       <br aria-hidden="true"/>
       <b class="ocpLegacyBold">
        1
       </b>
       : Grand Totals
       <br aria-hidden="true"/>
       <b class="ocpLegacyBold">
        2
       </b>
       : Grand and Subtotals
       <br aria-hidden="true"/>
       <b class="ocpLegacyBold">
        -1
       </b>
       : Grand Totals at Top
       <br aria-hidden="true"/>
       <b class="ocpLegacyBold">
        -2
       </b>
       : Grand and Subtotals at Top
      </p>
      <div class="ocpAlert">
       <p class="ocpAlertSection">
        <b class="ocpNote">
         Note:
        </b>
        For subtotals,
        <b class="ocpLegacyBold">
         row_fields
        </b>
        must have at least 2 columns. Numbers greater than 2 are supported provided
        <b class="ocpLegacyBold">
         row_field
        </b>
        has sufficient columns.
       </p>
      </div>
     </td>
    </tr>
    <tr>
     <td>
      <p>
       <b class="ocpLegacyBold">
        row_sort_order
       </b>
      </p>
      <p>
      </p>
     </td>
     <td>
      <p>
       A number indicating how columns should be sorted. Numbers correspond with columns in
       <b class="ocpLegacyBold">
        row_fields
       </b>
       followed by the columns in
       <b class="ocpLegacyBold">
        values
       </b>
       . If the number is negative, the rows are sorted in descending/reverse order.
      </p>
      <p>
       A vector of numbers can be provided when sorting based on only
       <b class="ocpLegacyBold">
        row_fields
       </b>
       .
      </p>
     </td>
    </tr>
    <tr>
     <td>
      <p>
       <b class="ocpLegacyBold">
        col_total_depth
       </b>
      </p>
      <p>
      </p>
     </td>
     <td>
      <p>
       Determines whether the column headers should contain totals. The possible values are:
      </p>
      <p>
       <b class="ocpLegacyBold">
        Missing
       </b>
       : Automatic: Grand totals and, where possible, subtotals.
       <br aria-hidden="true"/>
       <b class="ocpLegacyBold">
        0
       </b>
       : No Totals
       <br aria-hidden="true"/>
       <b class="ocpLegacyBold">
        1
       </b>
       : Grand Totals
       <br aria-hidden="true"/>
       <b class="ocpLegacyBold">
        2
       </b>
       : Grand and Subtotals
       <br aria-hidden="true"/>
       <b class="ocpLegacyBold">
        -1
       </b>
       : Grand Totals at Top
       <br aria-hidden="true"/>
       <b class="ocpLegacyBold">
        -2
       </b>
       : Grand and Subtotals at Top
      </p>
      <div class="ocpAlert">
       <p class="ocpAlertSection">
        <b class="ocpNote">
         Note:
        </b>
        For subtotals,
        <b class="ocpLegacyBold">
         col_fields
        </b>
        must have at least 2 columns. Numbers greater than 2 are supported provided
        <b class="ocpLegacyBold">
         col_field
        </b>
        has sufficient columns.
       </p>
      </div>
     </td>
    </tr>
    <tr>
     <td>
      <p>
       <b class="ocpLegacyBold">
        col_sort_order
       </b>
      </p>
      <p>
      </p>
     </td>
     <td>
      <p>
       A number indicating how rows should be sorted. Numbers correspond with columns in
       <b class="ocpLegacyBold">
        col_fields
       </b>
       followed by the columns in
       <b class="ocpLegacyBold">
        values
       </b>
       . If the number is negative, the rows are sorted in descending/reverse order.
      </p>
      <p>
       A vector of numbers can be provided when sorting based on only
       <b class="ocpLegacyBold">
        col_fields
       </b>
       .
      </p>
     </td>
    </tr>
    <tr>
     <td>
      <p>
       <b class="ocpLegacyBold">
        filter_array
       </b>
      </p>
      <p>
      </p>
     </td>
     <td>
      <p>
       A column-oriented 1D array of Booleans that indicate whether the corresponding row of data should be considered.
      </p>
      <div class="ocpAlert">
       <p class="ocpAlertSection">
        <b class="ocpNote">
         Note:
        </b>
        The length of the array must match the length of those provided to
        <b class="ocpLegacyBold">
         row_fields
        </b>
        and
        <b class="ocpLegacyBold">
         col_fields
        </b>
        .
       </p>
      </div>
     </td>
    </tr>
    <tr>
     <td>
      <p>
       <b class="ocpLegacyBold">
        relative_to
       </b>
      </p>
      <p>
      </p>
     </td>
     <td>
      <p>
       When using an aggregation function that requires two arguments,
       <b class="ocpLegacyBold">
        relative_to
       </b>
       controls which values are provided to the 2nd argument of the aggregation function. This is typically used when PERCENTOF is supplied to
       <b class="ocpLegacyBold">
        function
       </b>
       .
      </p>
      <p>
       The possible values are:
      </p>
      <p>
       <b class="ocpLegacyBold">
        0
       </b>
       : Column Totals (Default)
       <br aria-hidden="true"/>
       <b class="ocpLegacyBold">
        1
       </b>
       : Row Totals
       <br aria-hidden="true"/>
       <b class="ocpLegacyBold">
        2
       </b>
       : Grand Totals
       <br aria-hidden="true"/>
       <b class="ocpLegacyBold">
        3
       </b>
       : Parent Col Total
       <br aria-hidden="true"/>
       <b class="ocpLegacyBold">
        4
       </b>
       : Parent Row Total
      </p>
      <div class="ocpAlert">
       <p class="ocpAlertSection">
        <b class="ocpNote">
         Note:
        </b>
        This argument only has an impact if
        <b class="ocpLegacyBold">
         function
        </b>
        requires two arguments. If you supply a custom lambda function to
        <b class="ocpLegacyBold">
         function
        </b>
        , it should follow this pattern: LAMBDA(subset,totalset,SUM(subset)/SUM(totalset))
       </p>
      </div>
      <p>
      </p>
     </td>
    </tr>
   </tbody>
  </table>
  <p>
  </p>
 </section>
 <section aria-labelledby="ID0EDD" class="ocpSection">
  <h2 class="" id="ID0EDD">
   Examples
  </h2>
  <p>
   <b class="ocpLegacyBold">
    Example 1
   </b>
   : use PIVOTBY to generate a summary of total sales by product and year.
  </p>
  <p>
   <picture>
    <source sizes="(max-width: 480px) 320px, (max-width: 768px) 480px, (max-width: 1024px) 640px, 800px" srcset="/images/en-us/10446576-3524-46e0-9a41-53b64dac8d16?format=avif&amp;w=320 320w,        /images/en-us/10446576-3524-46e0-9a41-53b64dac8d16?format=avif&amp;w=480 480w,        /images/en-us/10446576-3524-46e0-9a41-53b64dac8d16?format=avif&amp;w=640 640w,        /images/en-us/10446576-3524-46e0-9a41-53b64dac8d16?format=avif&amp;w=800 800w" type="image/avif"/>
    <source sizes="(max-width: 480px) 320px, (max-width: 768px) 480px, (max-width: 1024px) 640px, 800px" srcset="/images/en-us/10446576-3524-46e0-9a41-53b64dac8d16?format=webp&amp;w=320 320w,        /images/en-us/10446576-3524-46e0-9a41-53b64dac8d16?format=webp&amp;w=480 480w,        /images/en-us/10446576-3524-46e0-9a41-53b64dac8d16?format=webp&amp;w=640 640w,        /images/en-us/10446576-3524-46e0-9a41-53b64dac8d16?format=webp&amp;w=800 800w" type="image/webp"/>
    <source sizes="(max-width: 480px) 320px, (max-width: 768px) 480px, (max-width: 1024px) 640px, 800px" srcset="/images/en-us/10446576-3524-46e0-9a41-53b64dac8d16?format=jpeg&amp;w=320 320w,        /images/en-us/10446576-3524-46e0-9a41-53b64dac8d16?format=jpeg&amp;w=480 480w,        /images/en-us/10446576-3524-46e0-9a41-53b64dac8d16?format=jpeg&amp;w=640 640w,        /images/en-us/10446576-3524-46e0-9a41-53b64dac8d16?format=jpeg&amp;w=800 800w" type="image/jpeg"/>
    <img alt="Using PIVOTBY to generate a summary of total sales by product and year. The formula reads: =PIVOTBY(C2:C76,A2:A76,D2:D76,SUM)" class="fluentImage" loading="lazy" src="/images/en-us/10446576-3524-46e0-9a41-53b64dac8d16" style="aspect-ratio: 904/665" width="904"/>
   </picture>
  </p>
  <p>
   <b class="ocpLegacyBold">
    Example 2
   </b>
   : use PIVOTBY to generate a summary of total sales by product and year. Sort descending by sales.
  </p>
  <p>
   <picture>
    <source sizes="(max-width: 480px) 320px, (max-width: 768px) 480px, (max-width: 1024px) 640px, 800px" srcset="/images/en-us/7cea0eed-3e33-4adb-8c9e-8d21319559f6?format=avif&amp;w=320 320w,        /images/en-us/7cea0eed-3e33-4adb-8c9e-8d21319559f6?format=avif&amp;w=480 480w,        /images/en-us/7cea0eed-3e33-4adb-8c9e-8d21319559f6?format=avif&amp;w=640 640w,        /images/en-us/7cea0eed-3e33-4adb-8c9e-8d21319559f6?format=avif&amp;w=800 800w" type="image/avif"/>
    <source sizes="(max-width: 480px) 320px, (max-width: 768px) 480px, (max-width: 1024px) 640px, 800px" srcset="/images/en-us/7cea0eed-3e33-4adb-8c9e-8d21319559f6?format=webp&amp;w=320 320w,        /images/en-us/7cea0eed-3e33-4adb-8c9e-8d21319559f6?format=webp&amp;w=480 480w,        /images/en-us/7cea0eed-3e33-4adb-8c9e-8d21319559f6?format=webp&amp;w=640 640w,        /images/en-us/7cea0eed-3e33-4adb-8c9e-8d21319559f6?format=webp&amp;w=800 800w" type="image/webp"/>
    <source sizes="(max-width: 480px) 320px, (max-width: 768px) 480px, (max-width: 1024px) 640px, 800px" srcset="/images/en-us/7cea0eed-3e33-4adb-8c9e-8d21319559f6?format=jpeg&amp;w=320 320w,        /images/en-us/7cea0eed-3e33-4adb-8c9e-8d21319559f6?format=jpeg&amp;w=480 480w,        /images/en-us/7cea0eed-3e33-4adb-8c9e-8d21319559f6?format=jpeg&amp;w=640 640w,        /images/en-us/7cea0eed-3e33-4adb-8c9e-8d21319559f6?format=jpeg&amp;w=800 800w" type="image/jpeg"/>
    <img alt="Example of the PIVOTBY function to generate a summary of total sales by product and year. The formula is =PIVOTBY(C2:C76,A2:A76,D2:D76,SUM,,,-2)" class="fluentImage" loading="lazy" src="/images/en-us/7cea0eed-3e33-4adb-8c9e-8d21319559f6" style="aspect-ratio: 904/652" width="904"/>
   </picture>
  </p>
 </section>
</article>
